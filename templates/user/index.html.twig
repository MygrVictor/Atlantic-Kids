{% extends 'base.html.twig' %}
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>
		{% block title %}Profil de {{ user.username }}{% endblock %}
	</title>
	
	{% block javascripts %}
		{{ importmap('app') }}
		<script>
			document.addEventListener('DOMContentLoaded', function () {
				const editBtn = document.getElementById('edit-btn');
				const editForm = document.getElementById('edit-form');

				// Cacher les champs de modification par défaut
				editForm.style.display = 'none';

				// Lorsque l'utilisateur clique sur le bouton, alterner l'affichage du formulaire
				editBtn.addEventListener('click', function () {
					if (editForm.style.display === 'none') {
						editForm.style.display = 'block';
					} else {
						editForm.style.display = 'none';
					}
				});
			});
		</script>
	{% endblock %}
</head>

<body>
	

	<!-- Profil -->
	{% block body %}
		<div>
			<div>
				<!-- Photo de profil et informations en haut -->
				<div class="text-center">
					<div>
						<!-- Photo de profil centrée -->
<div class="inline-block">
    {% if user.profilPicture %}
        <img src="{{ asset('uploads/profile_pictures/' ~ user.profilPicture) }}" alt="Photo de profil" width="100" height="100">
    {% else %}
        <img src="{{ asset('img/photoprofil.jpg') }}" alt="Photo de profil par défaut" width="300" height="300">
    {% endif %}
</div>

					</div>

					<!-- Nom d'utilisateur -->
					<h1>{{ user.username }}</h1>
					<p>{{ user.email }}</p>
				</div>

				<!-- Bio -->
				<div class="text-center">
					<h2>Un petit mot sur moi</h2>
					<p>
						{{ user.bio ? user.bio : 'Pas de bio définie.' }}
					</p>
				</div>

				<!-- Bouton Modifier -->
				<div class="text-center">
					<button id="edit-btn">
						Modifier vos informations
					</button>
				</div>

				<!-- Formulaire de mise à jour (initialement masqué) -->
				<div id="edit-form">
					<form method="post" action="{{ path('update_profile') }}" enctype="multipart/form-data">
						<!-- Bloc du nom d'utilisateur -->
						<div>
							<h2>Modifier le nom d'utilisateur</h2>
							<input type="text" name="username" value="{{ user.username }}">
						</div>
						<!-- Bloc de la bio -->
						<div>
							<h2>Modifier la bio</h2>
							<textarea name="bio" rows="4" placeholder="Écrivez votre bio ici...">{{ user.bio ? user.bio : '' }}</textarea>
						</div>

						<!-- Bloc de la photo de profil -->
						<div>
							<h2>Modifier la photo</h2>
							<div>
								<label for="profil_picture">Sélectionner une nouvelle photo</label>
								<input type="file" name="profil_picture" id="profil_picture">
							</div>
						</div>

						<!-- Bouton pour soumettre les changements -->
						<div class="text-center">
							<button type="submit">
								<span>Mettre à jour</span>
							</button>
						</div>
					</form>
				</div>

				<!-- Affichage des articles -->
				<div>
					<h2>Mes articles</h2>
					{% if articles is empty %}
						<p>Aucun article pour le moment.</p>
					{% else %}
						<ul>
							{% for article in articles %}
								<li>
									<div>
										<div class="flex">
											{% if article.user.profilPicture %}
												<img src="{{ asset('uploads/profil_picture/' ~ article.user.profilPicture) }}" alt="Photo de profil">
											{% else %}
												 <img src="{{ asset('img/photoprofil.jpg') }}" alt="Photo de profil par défaut" width="100" height="100">
											{% endif %}
											<div>
												<p>{{ article.user.username }}&nbsp;&nbsp;<span>
														{{ article.createdAt|date('d/m/Y - H:i') }}
													</span>
												</p>
												<p>{{ article.content }}</p>
												{% if article.image %}
													<img src="{{ asset('uploads/images/' ~ article.image) }}" alt="Image de l'article">
												{% endif %}
											</div>
										</div>
									</div>
								</li>
							{% endfor %}
						</ul>
					{% endif %}
				</div>
			</div>
		</div>
	{% endblock %}
</body>
